<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>
<body id="writePageBox">
    <div class="loading">
        <img src='../loading.gif'/>
        <span id='pageName'>index</span>
    </div>
     <script>        
        var url = window.location.pathname; // Get url of current webpage
        var filename = url.substring(url.lastIndexOf('/')+1,url.lastIndexOf('.')) // Get filename of current webpage
        
         if (filename.includes("/")){ // this page was found through a url with a directory only (/misalmon/dev/) instead of with page filename (/misalmon/dev/index.html)
             filename = document.getElementById("pageName").innerHTML
         }

        var TEMPLATE_HEADER_URL = '../template/content.txt"
        var TEMPLATE_CONTENT_URL = '../template/header.txt"
        var TEMPLATE_FOOTER_URL = '../template/footer.txt"
        var CONTENT_URL = '../content/' + filename + ".txt"; // Get the content for this webpage

        var temp_header; // stores template for header section
        var temp_footer; // stores template for footer section
        var temp_content; // stores template for content section
        var storedText; // to store the page's contents as text

        fetch(CONTENT_URL)
          .then(function(response) {
            response.text().then(function(text) {
              storedText = text;
            });
          });

         fetch(TEMPLATE_HEADER_URL)
          .then(function(response) {
            response.text().then(function(header_text) {
              temp_header = header_text;
            });
          });

         fetch(TEMPLATE_CONTENT_URL)
          .then(function(response) {
            response.text().then(function(content_text) {
              temp_content = content_text;
            });
          });

         fetch(TEMPLATE_FOOTER_URL)
          .then(function(response) {
            response.text().then(function(footer_text) {
              temp_footer = footer_text;
            });
          });
    </script>
    <py-config>
        [[fetch]]
        files=['./main.py']
        packages=['js']
    </py-config>
    <script type='py'>
        import main # import our main python page
        import js # necessary to display rendered html properly, as pyscript decodes it
        
        from js import document as Doc # get the webpage as a document object
        from js import storedText as this_content # import page's content variable
        from js import filename # import filename variable
        
        from js import temp_header as TEMP_HEADER
        from js import temp_content as TEMP_CONTENT
        from js import temp_footer as TEMP_FOOTER

        dynamicTemplate = True

        """
        #print("PAGE FILENAME: "+filename) # testing
        if not ("." in filename): # causes error otherwise as github allows directories to refer to their index.html when just directory is entered
            # ex: /dev/ can bring /dev/index.html's content
            #print("NO DOT in filename[%s]" % filename)
            fileName = 'index'
        """
        
        #this_content = js.storedText
        thisPage = Doc.getElementById('writePageBox') # get the element where we will write this text
        
        if this_content != None and not ("404" in this_content): # if the contents of this variable is not null and the page was found
            if dynamicTemplate == True:    
                thisPage.innerHTML = main.pageFromContent(this_content,fileName,TEMP_HEADER,TEMP_CONTENT,TEMP_FOOTER)
            else:
                thisPage.innerHTML = main.pageFromContent(this_content,fileName) # creates a page from default static template embedded in python file
        else: # if the page's contents were null
            thisPage.innerHTML = main.getPage() # retreives a default page content with default static template embedded in python;
    </script>
</body>
</html>
